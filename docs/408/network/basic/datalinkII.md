---
title: 局域网和广域网的数据链路层
date: 2021-9-4
tags:
  - Network
---

## 局域网的数据链路层

> 被一个学校、单位、楼使用的网络

主机与主机之间通过交换机（数据链路层设备）连接在一起，局域网中的主机和交换机实现数据链路层

局域网之间通过路由器连接在一起

### 特点及三要素

特点

- 物理范围较小
- 专门的传输介质，速率高
- 延迟短，可靠性较高
- 支持多种传输介质
- 往往采用广播的通信模式

局域网的三要素：

- 网络拓扑结构：星型网、环形网、总线型网和树形网
- 传输介质：双绞线
- 介质访问控制方法

### 以太网子层

局域网的标准：以太网

- 在考试里面，数据链路层的局域网约等于以太网，而以太网等于802.3局域网

**LLC & MAC**

IEEE 802 将局域网的数据链路层拆成两个子层

- 逻辑链路控制 LLC（logical link control） 子层：向上给网络层提供服务，与传输媒体无关
- 媒体接入控制 MAC（medium access control） 子层：向下连接物理层

### 以太网服务、编码及争用期

以太网提供的服务：尽最大努力的交付（不可靠）

当收到有茶错的帧时直接丢弃，差错的纠正由高层处理，并且无法识别帧是否是重传的

#### 编码

以太网发送的数据使用曼彻斯特或差分曼彻斯特编码（为了保证同步），码元率 = 2数据率（因为曼彻斯特需要两个码元，才能产生一个“变化”，即传递一个比特）

#### CSMA/CD - 争用期

争用期指最远两端的往返时延 —— 能够知道是否发生碰撞（冲突），也叫碰撞窗口

如果过了争用期仍未检测到碰撞，则肯定这次发送不会发生碰撞

10 Mbit/s 以太网争用期的长度：
$$
51.2\mu s
$$

- 在争用期，10Mb/s 的以太网可以发送 512bit，即 64 字节的数据，带宽乘以时间 ——> 时延带宽积
- 所以，若前 64 字节数据未发生冲突，则之后的数据就不回发生冲突
- 这个 64 字节也被称为 10Mb/s 以太网的最短有效帧长

推广到一般：最短有效帧长 = 争用期 × 发送速度（带宽）

- 就是**时延带宽积**

以太网规定了最短有效帧长为 64 字节，凡长度小于 64 字节的帧都是由于冲突而异常中止的无效帧

### 以太网 MAC 层

#### MAC 层的通信方式

广播模式只能实现一对多，点到点通信实现一对一

以太网将计算机连在一条总线上，这意味着一发送全部站点都会收到数据，很容易实现一对多的通信

收到数据不意味接收，MAC 层以此实现一对一通信

- 将目标接收站的硬件地址写入帧首部的目的地址字段中
- 仅当帧中目的地指与适配器的硬件地址一致时，才接收该数据帧

硬件地址，也叫物理地址、MAC 地址

- 48 位的 MAC 地址
- 前六个字节（低 24 位）的后三个字节由厂家自行指派

#### MAC 地址类型

- 广播地址（一对全体，校园广播）：FFFF FFFF FFFF，所有局域网上的计算机均接收
- 多播地址（一对多，班级广播）：01005E000000 ～ 01005E7FFFFF，只要 MAC 地址在这一范围内，即为多播地址
- 单播地址（一对一，私信）：只要不是上两种，就是单播地址

MAC 地址（硬件地址）其实就是网卡地址，焊在网卡上的

~~~bash
yay -S net-tools

# 查看网卡地址
ifconfig
~~~

#### 网卡

MAC 层也就位于网卡上，网卡也叫 通信适配器、网络接口卡 NIC

网卡的重要功能：

- 进行串行/并行转换
- 数据缓存
- 在操作系统安装设备驱动程序
- 实现以太网协议

装网卡驱动实际上就是在实现以太网协议，以实现无线上网

局域网中常常是串行通信，而计算机内部尝是并行通信，这里就涉及到传并行的转换（通过 MAC 实现）

#### 信息处理

从局域网中收到帧后，先检查本机 MAC 和帧中的目的 MAC 是否一致

- 若相同，则接收
- 若不同，则直接丢弃，不作任何处理

MAC 地址本质上来讲就是一个二进制标记（身份证号）

### 以太网的帧格式

> 有人的地方就有江湖
>
> 拿到标准即拿到下一代发展的权利

MAC 帧格式有两种常用标准

- DIX Ethernet V2 标准
- IEEE 的 802.3 标准

最常用的 MAC 帧是以太网 V2 的格式

固定格式共占 6 + 6 + 2 + 4 = 18 B，帧的有效长度为 64～1518 B，其中有效数据长度为 46～1500 B

- 目的地址：目的 MAC 地址，占 6 字节，和硬件地址保持一致
- 源地址：发送方的地址，也占 6 字节
- 类型：指明帧向上交给什么协议处理，即指定给谁提供服务，占 2 字节
- 数据：46～1500，数据的有效长度
- FCS 校验信息：校验值，占 4 字节，将校验结果放在该处，检测成功率极高

无效的 MAC 帧

- 数据长度和长度字段指不一致
- 帧长度不是整数
- 帧检验序列 FCS 查出有差错
- 数据字段长度不在 46～1500
- 帧长度

直接丢弃，不关心是否重传

另外，还有 8 个字节的前导码，包含 7 字节的前同步码和帧开始定界符

例题：

<img src="../../../.vuepress/public/img/trans1.png">

<img src="../../../.vuepress/public/img/trans2.png">

## 广域网的数据链路层

> 这种信道往往使用一对一的点对点通信模式，因为一般来说信道很长，广播代价很大

连接不同的局域网，让信息在局域网之间通信，通过路由器进行跨网络通信，涉及到网络层
