---
title: 数据链路层
date: 2021-9-4
tags:
  - Network

---

## 数据链路层概述

> 五星重难点

传输的基本单位是 帧，在对等的数据链路层之间的数字管道中传输，注意他并不必考虑比特的传输

不同的链路层可能采用不同的数据链路层协议

广域网中的主机、路由器等都必须实现数据链路层（还包括网络层和物理层）

- 广域网中实现的点对点通信

局域网中的主机、交换机等都必须实现数据链路层（不包括网络层）

- 局域网内部往往刺采用广播通信

## 数据链路层的功能

也是数据链路层的基本问题

- 封装成帧
- 透明传输
- 差错控制
- 流量控制

### 封装成帧

物理层接收到的比特会上传到数据链路层，链路层会对这串比特加上帧首部和尾部，表明这是一段帧，最常用的办法是加上控制字符 SOH(start of header) / EOT(end of transmission)，表示帧的开头和结尾

两种封装方法：

- 字符计数法：在首部加入内容比特的长度，一旦出错，对正确性的影响最大，一般不用
- 字符填充的首尾定界符法：加入帧头（DLE STX）和帧尾（DLE ETX）
- 比特填充的首位标志法
- 违规编码法

### 透明传输

若数据中某个字节的二进制代码切好为 SOH / EOT，链路层就会找到错误的帧边界

为了处理以上问题，在处理数据的时候使用字节填充，碰到 SOH 的数据，就在原数据前加上 ESC，碰到 ESC、EOT 同理，这样就避免了错误边界的产生（就像反斜杠转义）

### 差错控制

数据传输过程中可能会出现比特差错，即1变为0，0变为1

- 误码率：传输错误的比特占比特总数的比率
- 在数据链路层中广泛使用循环冗余检验 CRC 的检错技术

CRC 技术：在原始数据，k 位数据位后添加 n 位冗余码，一起发送，在接收端检测冗余位的误码率

- 补 3 位 0 的数据，设原始数据 101001，补3位0则为 101001000
- 给定除数 P = 1101，用 101001000 除以 P，这里注意，二进制除法，实际上就是在各位上进行异或操作（不同为1，相同为0）
- 得到余数 R = 001，商 Q = 110100
- 用余数 011 代替原先补的3位0，得到所需数据 CRC = 101001011
- 再用 CRC 除以 P，若余数为 0，则接受，反之则丢弃数据（认为失真严重）

两次除以 P，第一次得到 CRC，第二次用 CRC 补全判断余数是否为 0

注意：CRC 循环冗余技术只能做到无差错接受（发送什么就收到什么），但无法提供可靠传输（没有确认和重传机制）

- CRC 无法决定数据之间的传输顺序
- CRC 不能保证数据传输过程中不丢失
- CRC 无法判断重复数据

数据链路层协议都是不可靠的传输协议

### 流量控制

> 相对重要，频率高难度大

数据结构

- 线性结构：首、尾、前驱和后继
- 队列：尾进头出（排队出站）

避免队列的假溢出（尾指针超过上界，但元素未满，因为添加/删除过程中头/尾指针不断后移） ——> 循环队列

流量控制：让接收方来控制发送方发送数据的速度，避免发的太快，接收方无法有效、准确的处理发送的数据，造成溢出或者丢失

- 一种点对点控制，即接收方控制发送方（1v1）

在数据传输过程中

- 发送方A和接收方B分别维护一个发送窗口和一个接受窗口
- 发送窗口表示：没有收到确认时，继续发送数据直到空
- 接受窗口表示：只允许接受落入窗口内的数据

停止-等待机制
