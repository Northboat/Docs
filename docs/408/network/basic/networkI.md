---
title: 网络层
date: 2021-9-7
tags:
  - Network
---

## 概述

### 网络层概述

> 网络层是最重要的章节

网络层向上只提供简单灵活的、无连接的、尽最大努力交付的数据报服务

网络在发送分组时不需要先建立连接，每个分组（IP 数据报）独立发送，与其他分组无关，也不进行编号

不提供服务质量的保证，分组有可能出错、丢失、重复和失序，以及时限

分组在互联网中传递，常会经过许多异构的网络

### 网际协议：IP 协议簇

与 IP 配套的有三个协议

- 地址解析协议 ARP：Address Resolution Protocol
- 网际控制报文协议 ICMP：Internet Control Message Protocol
- 网际组管理协议 IGMP：Internet Group Management Protocol

ICMP、IGMP 向上层传输层提供服务，ARP 向下网络接口层调取服务，IP 工作在二者之间1

## IP 地址

网络层连接异构网络，需要一种方案来标识异构网络，这种标识符也就是 IP 地址

- 上一种标识符是 MAC 地址，用于标识硬件，IP 地址用于标识一整块网络

分类的 IP 地址：最基本的编址方法

改进方案：

- 子网的划分
- CIDR
- 私有 IP
- IPv6

### 基本分类 IP 地址

将 IP 地址划分成若干个固定类

- 每一类地址都由两个固定长度的字段组成，其中一个是网络号 net-id，标志主机/路由器连接到的网络；另一个是主机号 host-id，标志该主机，共 32 位二进制代码
- 网络号和主机号的组合在指定网络范围内必须是唯一的
- 一个 IP 地址在整个互联网范围内是唯一的，一个 IP 对应一个主机

根据网络号和主机号所占位数不同，分为以下 5 类地址

- A 类地址：8+24
- B 类地址：16+16
- C 类地址：24+8
- D 类地址：1110+多播地址
- E 类地址：1111+保留为今后使用

32 位二进制代码书写并不方便，于是我们将其 8 位分为一组，然后化为十进制
——> 点分十进制

一些特殊的 IP 地址：

- 0.0.0.0
  - 代表本网络
  - 代表 DHCP 请求的源 IP 地址
  - OSPF 的根区域
- 255.255.255.255
  - 代表全网广播
  - 代表 DHCP 请求的目的 IP 地址
- 127.0.0.0：环回地址
- 网络地址：主机位全为 0
- 广播地址：主机位全为 1

#### 有效 IP 地址

以 c 类 IP 为例，hots-ip 共 8 位，于是有 2^8 = 256 种编号，但是要去掉两种特殊 IP

- 网络地址：0.0.0.0
- 广播地址：255.255.255.255

于是有效 IP 地址为 254 个 ——> 推广到一般，若主机地址 n 位，那么有效 IP 共 2^n-2 个

#### 分类 IP 特点

管理机构只分配网络号，主机号由单位分配，注意数据在互联网中的转发只考虑网络号

一个网络对应一个 IP 地址，这意味着，若一个主机连接有两个网络，那么他就有两个不同的 IP 地址；路由器至少连接有两个网络，也就意味着他至少有两个 IP 地址

用转发器/网桥连接的局域网仍属于同一个网络，共用一个网络号

#### 划分子网

由于主机号太多了，特别在a、b网络中，24位和16位的主机号，很多单位根本用不上这么多 IP 地址，于是我们采用子网（subnet）的方式对 IP 地址进行分组

如 172.24.12.52（这是一个b类网络，因为首字节位于128-191），我们将其第三个字节作为子网IP，划分为

- 172.24.9.xx
- 172.24.12.xx
- 172.24.24.xx

这样就大大提供了IP地址的利用率

#### 子网掩码

划分子网的过程中出现了新的问题，就是无法区分哪是子网IP，就比如 172.24.12.52，我怎么知道那个 12 是代表子网ip还是主机ip的一部分

于是我们引入子网掩码

其长度和完整的ip地址保持一致，即 32 位，从左往右是一串连续的 1，从右往左是一串连续的 0，1 对应的位置的就是网络号和子网号，相应 0 对应的位置就是主机号

- a类的标准子网掩码：255.0.0.0
- b类的标准子网掩码：255.255.0.0
- c类的标准子网掩码：255.255.255.0

再通过首字节范围判断网络类型，确认网络号长度，于是将三个部分分开

- a类：0-127
- b类：128-191
- c类：192-225

#### 网络地址和IP地址

如何将IP地址转为网络地址？

- 根据子网掩码和首字节范围确定网络号、子网号和主机号
- 将主机号全置零，即为网络地址

注意：在规范的IP地址中，主机号不能全为0或1
